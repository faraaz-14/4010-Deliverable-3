<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Make Query</title>
    <style>
      
       
        .filters-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            width: 18%; /* Adjusting to give space between elements */
        }
        select {
            padding: 8px;
            font-size: 14px;
        }
        #queryButton {
            width: 100%;
            padding: 10px;
            color: rgb(0, 0, 0);
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        #queryButton:hover {
            background-color: #e90dc4;
        }
        #results {
            margin-top: 20px;
        }
        #results div {
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>

    <script>
        async function fetchFilters() {
            try {
                const response = await fetch('/api/filters');
                const data = await response.json();
                
                const makeDropdown = document.getElementById('carMakeDropdown');
                data.makes.forEach(make => {
                    const option = document.createElement('option');
                    option.value = make;
                    option.textContent = make;
                    makeDropdown.appendChild(option);
                });

                const yearDropdown = document.getElementById('carYearDropdown');
                data.years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearDropdown.appendChild(option);
                });

                const colorDropdown = document.getElementById('carColorDropdown');
                data.colors.forEach(color => {
                    const option = document.createElement('option');
                    option.value = color;
                    option.textContent = color;
                    colorDropdown.appendChild(option);
                });

                const rateRangeDropdown = document.getElementById('rateRangeDropdown');
                data.rateRanges.forEach(range => {
                    const option = document.createElement('option');
                    option.value = range.min + '-' + range.max;
                    option.textContent = range.label;
                    rateRangeDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching filters:', error);
            }
        }

        async function fetchModels() {
            const make = document.getElementById('carMakeDropdown').value;
            if (!make) return;

            try {
                const response = await fetch(`/api/models?make=${make}`);
                const data = await response.json();
                const modelDropdown = document.getElementById('carModelDropdown');
                modelDropdown.innerHTML = ''; 
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select a model';
                modelDropdown.appendChild(defaultOption);

                data.models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching models:', error);
            }
        }

        async function queryVehicles() {
            const make = document.getElementById('carMakeDropdown').value;
            const model = document.getElementById('carModelDropdown').value;
            const year = document.getElementById('carYearDropdown').value;
            const color = document.getElementById('carColorDropdown').value;
            const rateRange = document.getElementById('rateRangeDropdown').value;

            const queryParams = new URLSearchParams();
            if (make) queryParams.append('make', make);
            if (model) queryParams.append('model', model);
            if (year) queryParams.append('year', year);
            if (color) queryParams.append('color', color);
            if (rateRange) queryParams.append('rateRange', rateRange);

            try {
                const response = await fetch(`/api/vehicles?${queryParams.toString()}`);
                const vehicles = await response.json();
                
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';

                if (vehicles.length === 0) {
                    resultsDiv.innerHTML = '<p>No vehicles found.</p>';
                } else {
                    vehicles.forEach(vehicle => {
                        const vehicleDiv = document.createElement('div');
                        vehicleDiv.innerHTML = `
                            <p><strong>VIN:</strong> ${vehicle.vinNumber}</p>
                            <p><strong>Make:</strong> ${vehicle.make}</p>
                            <p><strong>Model:</strong> ${vehicle.model}</p>
                            <p><strong>Year:</strong> ${vehicle.year}</p>
                            <p><strong>Rate:</strong> $${vehicle.rate}</p>
                            <p><strong>Color:</strong> ${vehicle.color}</p>
                            <p><strong>Status:</strong> ${vehicle.status}</p>
                        `;
                        resultsDiv.appendChild(vehicleDiv);
                    });
                }
            } catch (error) {
                console.error('Error querying vehicles:', error);
            }
        }

        window.onload = function() {
            fetchFilters();
            document.getElementById('carMakeDropdown').addEventListener('change', fetchModels);
            document.getElementById('queryButton').addEventListener('click', queryVehicles);
        };
    </script>
</head>
<body>
    <h1>Car Search</h1>
    
    <div class="filters-container">
        <div class="filter-group">
            <label for="carMakeDropdown">Car Make</label>
            <select id="carMakeDropdown">
                <option value="">Select a make</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="carModelDropdown">Car Model</label>
            <select id="carModelDropdown">
                <option value="">Select a model</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="carYearDropdown">Car Year</label>
            <select id="carYearDropdown">
                <option value="">Select a year</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="carColorDropdown">Car Color</label>
            <select id="carColorDropdown">
                <option value="">Select a color</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="rateRangeDropdown">Rate Range</label>
            <select id="rateRangeDropdown">
                <option value="">Select a rate range</option>
            </select>
        </div>
    </div>

    <button id="queryButton">Search</button>

    <h2>Results:</h2>
    <div id="results"></div>
</body>
</html>
